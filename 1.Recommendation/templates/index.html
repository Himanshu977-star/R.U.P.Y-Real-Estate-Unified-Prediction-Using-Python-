<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Crop Recommendation System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(to right, #ffffff, rgb(255, 255, 255));
      }
      button {
        background-color: #008000;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 18px;
        font-weight: bold;
        width: 100%;
      }
      button:hover {
        background-color: rgb(115, 128, 0);
      }
      h1 {
        color: black;
        text-align: center;
        font-size: 30px;
        padding-bottom: 10px;
      }
      p {
        font-size: 18px;
        font-weight: bold;
        color: white;
      }
      .container {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(30px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.9);
      }
      .card {
        margin: auto;
        text-align: center;
        color: white;
        max-width: 400px;
      }
      .form-control {
        font-size: 16px;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Krishival:-Crop Recommendation</a>
      </div>
    </nav> -->

    <div class="container my-4">
      <h1 class="text-success">Crop Recommendation System ðŸŒ±</h1>

      <!-- City Input Field -->
      <div class="mb-3">
        <label for="city" class="form-label text-black">Enter Location:</label>
        <input
          type="text"
          id="city"
          class="form-control"
          placeholder="Enter Location Name"
          required
        />
      </div>

      <form
        id="weatherForm"
        action="/predict"
        method="POST"
        onsubmit="return validateForm()"
      >
        <div class="row g-3">
          <div class="col-md-6">
            <label for="Nitrogen">Nitrogen (kg/ha)</label>
            <input
              type="number"
              id="Nitrogen"
              name="Nitrogen"
              placeholder="Enter Nitrogen"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="Phosporus">Phosphorus (kg/ha)</label>
            <input
              type="number"
              id="Phosporus"
              name="Phosporus"
              placeholder="Enter Phosphorus"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="Potassium">Potassium (kg/ha)</label>
            <input
              type="number"
              id="Potassium"
              name="Potassium"
              placeholder="Enter Potassium"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="pH">pH</label>
            <input
              type="number"
              id="pH"
              name="pH"
              placeholder="Enter pH value"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="Temperature">Temperature (Â°C)</label>
            <input
              type="number"
              id="Temperature"
              name="Temperature"
              placeholder="Enter Temperature"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="Humidity">Humidity (%)</label>
            <input
              type="number"
              id="Humidity"
              name="Humidity"
              placeholder="Enter Humidity"
              class="form-control"
              required
            />
          </div>

          <div class="col-md-6">
            <label for="Rainfall">Rainfall (mm)</label>
            <input
              type="number"
              id="Rainfall"
              name="Rainfall"
              placeholder="Enter Rainfall"
              class="form-control"
              required
            />
          </div>
          <div class="col-12 text-center">
            <button type="submit">Get Recommendation</button>
          </div>
        </div>
      </form>

      {% if result %}
      <div class="card bg-dark mt-4">
        <img
          src="{{url_for('static', filename='crop.png')}}"
          style="width: 70px; height: 70px"
          class="card-img-top mx-auto mt-3"
          alt="Crop Image"
        />
        <div class="card-body">
          <h5 class="card-title">Recommended Crop:</h5>
          <p class="card-text">
            <b>{{ result }}</b> is the best crop to be cultivated right there.
          </p>
        </div>
      </div>
      {% endif %}
    </div>

    <script>
      function validateForm() {
        // Validate Nitrogen (0-200 kg/ha)
        var nitrogen = document.getElementById("Nitrogen").value;
        if (nitrogen < 0 || nitrogen > 300) {
          alert("Nitrogen value must be between 0 and 300 kg/ha.");
          return false;
        }

        // Validate Phosphorus (0-100 kg/ha)
        var phosphorus = document.getElementById("Phosporus").value;
        if (phosphorus < 0 || phosphorus > 100) {
          alert("Phosphorus value must be between 0 and 100 kg/ha.");
          return false;
        }

        // Validate Potassium (0-300 kg/ha)
        var potassium = document.getElementById("Potassium").value;
        if (potassium < 0 || potassium > 200) {
          alert("Potassium value must be between 0 and 200 kg/ha.");
          return false;
        }

        // Validate pH (4.5 - 8.0)
        var ph = document.getElementById("pH").value;
        if (ph < 1.0 || ph > 14.0) {
          alert("pH value must be between 1.0 and 14.0");
          return false;
        }

        // Validate Temperature (-10Â°C to 50Â°C)
        var temperature = document.getElementById("Temperature").value;
        if (temperature < -50 || temperature > 50) {
          alert("Temperature must be between -50Â°C and 50Â°C.");
          return false;
        }

        // Validate Humidity (0% - 100%)
        var humidity = document.getElementById("Humidity").value;
        if (humidity < 0 || humidity > 100) {
          alert("Humidity must be between 0% and 100%.");
          return false;
        }

        // Validate Rainfall (0 mm to 500 mm)
        var rainfall = document.getElementById("Rainfall").value;
        if (rainfall < 0 || rainfall > 1000) {
          alert("Rainfall value must be between 0 mm and 1000 mm.");
          return false;
        }

        return true;
      }

      // Function to fetch weather data based on user-entered city
      async function fetchWeatherData() {
        const city = document.getElementById("city").value;
        if (!city) {
          alert("Please enter a city.");
          return;
        }

        const apiKey = "1722a1764a0842ca1d8f2a8ee7c91c5b"; // Replace with your actual API key
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`
        );
        const data = await response.json();

        if (data.main) {
          document.getElementById("Temperature").value = Math.round(
            data.main.temp
          );
          document.getElementById("Humidity").value = data.main.humidity;
          document.getElementById("Rainfall").value = data.rain
            ? data.rain["1h"]
            : 0;
        } else {
          alert("Failed to fetch weather data. Please check the city name.");
        }
      }

      // Fetch weather data when the city input field loses focus
      document
        .getElementById("city")
        .addEventListener("blur", fetchWeatherData);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
